<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>translate.html</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<meta name="generator" content="SynEdit HTML exporter" />
<style type="text/css">
<!--
body { color: #000000; background-color: #FFFFFF; }
.cpp1-assembler { color: #0000FF; }
.cpp1-character { color: #000000; }
.cpp1-comment { color: #0078D7; font-style: italic; }
.cpp1-float { color: #800080; }
.cpp1-hexadecimal { color: #800080; }
.cpp1-identifier { color: #000000; }
.cpp1-illegalchar { color: #000000; }
.cpp1-number { color: #800080; }
.cpp1-octal { color: #800080; }
.cpp1-preprocessor { color: #008000; }
.cpp1-reservedword { color: #000000; font-weight: bold; }
.cpp1-space { background-color: #FFFFFF; color: #000000; }
.cpp1-string { color: #0000FF; font-weight: bold; }
.cpp1-symbol { color: #FF0000; font-weight: bold; }
-->
</style>
</head>
<body>
<pre>
<code><span style="font: 10pt Consolas;"><span class="cpp1-preprocessor">#include &lt;stdio.h&gt;
#include &lt;string.h&gt;
#include &lt;stdlib.h&gt;

#include &quot;tables.h&quot;
#include &quot;translate_utils.h&quot;
#include &quot;translate.h&quot;

</span><span class="cpp1-comment">/* SOLUTION CODE BELOW */
</span><span class="cpp1-reservedword">const</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> TWO_POW_SEVENTEEN </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-number">131072</span><span class="cpp1-symbol">;</span><span class="cpp1-space">    </span><span class="cpp1-comment">// 2^17

/* Writes instructions during the assembler's first pass to OUTPUT. The case
   for general instructions has already been completed, but you need to write
   code to translate the li and blt pseudoinstructions. Your pseudoinstruction 
   expansions should not have any side effects.

   NAME is the name of the instruction, ARGS is an array of the arguments, and
   NUM_ARGS specifies the number of items in ARGS.

   Error checking for regular instructions are done in pass two. However, for
   pseudoinstructions, you must make sure that ARGS contains the correct number
   of arguments. You do NOT need to check whether the registers / label are 
   valid, since that will be checked in part two.

   Also for li:
    - make sure that the number is representable by 32 bits. (Hint: the number 
        can be both signed or unsigned).
    - if the immediate can fit in the imm field of an addiu instruction, then
        expand li into a single addiu instruction. Otherwise, expand it into 
        a lui-ori pair.
        

   For move, blt, bgt, and traddu:
    - your expansion should use the fewest number of instructions possible.

   MARS has slightly different translation rules for li, and it allows numbers
   larger than the largest 32 bit number to be loaded with li. You should follow
   the above rules if MARS behaves differently.

   Use fprintf() to write. If writing multiple instructions, make sure that 
   each instruction is on a different line.

   Returns the number of instructions written (so 0 if there were any errors).
 */
</span><span class="cpp1-reservedword">unsigned</span><span class="cpp1-space"> write_pass_one</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">FILE</span><span class="cpp1-symbol">*</span><span class="cpp1-space"> output</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">const</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">char</span><span class="cpp1-symbol">*</span><span class="cpp1-space"> name</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">char</span><span class="cpp1-symbol">**</span><span class="cpp1-space"> args</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> num_args</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-symbol">{
</span><span class="cpp1-space">    </span><span class="cpp1-reservedword">char</span><span class="cpp1-symbol">*</span><span class="cpp1-space"> zero_reg </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-string">&quot;$0&quot;</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">    </span><span class="cpp1-comment">/* Increment with every call to fprintf */
</span><span class="cpp1-space">    </span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> num_instrct </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">    </span><span class="cpp1-reservedword">if</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">strcmp</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">name</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> </span><span class="cpp1-string">&quot;li&quot;</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-symbol">==</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-symbol">{
</span><span class="cpp1-space">      </span><span class="cpp1-comment">/* YOUR CODE HERE */
</span><span class="cpp1-space">      </span><span class="cpp1-reservedword">if</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">num_args </span><span class="cpp1-symbol">==</span><span class="cpp1-space"> </span><span class="cpp1-number">2</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-symbol">{
</span><span class="cpp1-space">        </span><span class="cpp1-reservedword">long</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> signed_num</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">        </span><span class="cpp1-reservedword">long</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> lower </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-symbol">-</span><span class="cpp1-number">2147483648</span><span class="cpp1-symbol">;</span><span class="cpp1-space">  </span><span class="cpp1-comment">/* -(2^31) */
</span><span class="cpp1-space">        </span><span class="cpp1-reservedword">long</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> upper </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-number">4294967295</span><span class="cpp1-symbol">;</span><span class="cpp1-space">   </span><span class="cpp1-comment">/* +(2^32) - 1, incase unsigned */
</span><span class="cpp1-space">        </span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> x </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> translate_num</span><span class="cpp1-symbol">(&amp;</span><span class="cpp1-identifier">signed_num</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> args</span><span class="cpp1-symbol">[</span><span class="cpp1-number">1</span><span class="cpp1-symbol">],</span><span class="cpp1-space"> lower</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> upper</span><span class="cpp1-symbol">);
</span><span class="cpp1-space">        </span><span class="cpp1-reservedword">if</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">x </span><span class="cpp1-symbol">==</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-symbol">{
</span><span class="cpp1-space">          </span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> low </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-symbol">-</span><span class="cpp1-number">32768</span><span class="cpp1-symbol">;</span><span class="cpp1-space">    </span><span class="cpp1-comment">/* -(2^15) */
</span><span class="cpp1-space">          </span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> high </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-number">65536</span><span class="cpp1-symbol">;</span><span class="cpp1-space">    </span><span class="cpp1-comment">/* +(2^16), incase unsigned */
</span><span class="cpp1-space">          </span><span class="cpp1-reservedword">if</span><span class="cpp1-space"> </span><span class="cpp1-symbol">((</span><span class="cpp1-identifier">signed_num </span><span class="cpp1-symbol">&gt;=</span><span class="cpp1-space"> low </span><span class="cpp1-symbol">&amp;&amp;</span><span class="cpp1-space"> signed_num </span><span class="cpp1-symbol">&lt;=</span><span class="cpp1-space"> </span><span class="cpp1-symbol">((</span><span class="cpp1-identifier">low </span><span class="cpp1-symbol">*</span><span class="cpp1-space"> </span><span class="cpp1-symbol">-</span><span class="cpp1-number">1</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-symbol">-</span><span class="cpp1-space"> </span><span class="cpp1-number">1</span><span class="cpp1-symbol">))</span><span class="cpp1-space"> </span><span class="cpp1-symbol">||</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">signed_num </span><span class="cpp1-symbol">&gt;=</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-space"> </span><span class="cpp1-symbol">&amp;&amp;</span><span class="cpp1-space"> signed_num </span><span class="cpp1-symbol">&lt;=</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">high </span><span class="cpp1-symbol">-</span><span class="cpp1-space"> </span><span class="cpp1-number">1</span><span class="cpp1-symbol">)))</span><span class="cpp1-space"> </span><span class="cpp1-symbol">{
</span><span class="cpp1-space">            </span><span class="cpp1-reservedword">char</span><span class="cpp1-symbol">*</span><span class="cpp1-space"> adu </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-string">&quot;addiu&quot;</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">            fprintf</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">output</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> </span><span class="cpp1-string">&quot;%s %s, %s, %ld\n&quot;</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> adu</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> args</span><span class="cpp1-symbol">[</span><span class="cpp1-number">0</span><span class="cpp1-symbol">],</span><span class="cpp1-space"> zero_reg</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> signed_num</span><span class="cpp1-symbol">);
</span><span class="cpp1-space">            num_instrct </span><span class="cpp1-symbol">+=</span><span class="cpp1-space"> </span><span class="cpp1-number">1</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">            </span><span class="cpp1-reservedword">return</span><span class="cpp1-space"> num_instrct</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">          </span><span class="cpp1-symbol">}
</span><span class="cpp1-space">          </span><span class="cpp1-reservedword">long</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> top_half </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> signed_num </span><span class="cpp1-symbol">&gt;&gt;</span><span class="cpp1-space"> </span><span class="cpp1-number">16</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">          </span><span class="cpp1-reservedword">long</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> bottom_half </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> signed_num </span><span class="cpp1-symbol">&amp;</span><span class="cpp1-space"> </span><span class="cpp1-hexadecimal">0xFFFF</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">          fprintf</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">output</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> </span><span class="cpp1-string">&quot;lui %s, %ld\n&quot;</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> args</span><span class="cpp1-symbol">[</span><span class="cpp1-number">0</span><span class="cpp1-symbol">],</span><span class="cpp1-space"> top_half</span><span class="cpp1-symbol">);
</span><span class="cpp1-space">          num_instrct </span><span class="cpp1-symbol">+=</span><span class="cpp1-space"> </span><span class="cpp1-number">1</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">          fprintf</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">output</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> </span><span class="cpp1-string">&quot;ori %s, %s, %ld\n&quot;</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> args</span><span class="cpp1-symbol">[</span><span class="cpp1-number">0</span><span class="cpp1-symbol">],</span><span class="cpp1-space"> args</span><span class="cpp1-symbol">[</span><span class="cpp1-number">0</span><span class="cpp1-symbol">],</span><span class="cpp1-space"> bottom_half</span><span class="cpp1-symbol">);
</span><span class="cpp1-space">          num_instrct </span><span class="cpp1-symbol">+=</span><span class="cpp1-space"> </span><span class="cpp1-number">1</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">          </span><span class="cpp1-reservedword">return</span><span class="cpp1-space"> num_instrct</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">        </span><span class="cpp1-symbol">}
</span><span class="cpp1-space">      </span><span class="cpp1-symbol">}
</span><span class="cpp1-space">      </span><span class="cpp1-reservedword">return</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">    </span><span class="cpp1-symbol">}</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">else</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">if</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">strcmp</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">name</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> </span><span class="cpp1-string">&quot;move&quot;</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-symbol">==</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-symbol">{
</span><span class="cpp1-space">      </span><span class="cpp1-comment">/* YOUR CODE HERE */
</span><span class="cpp1-space">      </span><span class="cpp1-reservedword">if</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">num_args </span><span class="cpp1-symbol">==</span><span class="cpp1-space"> </span><span class="cpp1-number">2</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-symbol">{
</span><span class="cpp1-space">        </span><span class="cpp1-reservedword">char</span><span class="cpp1-symbol">*</span><span class="cpp1-space"> add </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-string">&quot;add&quot;</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">        fprintf</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">output</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> </span><span class="cpp1-string">&quot;%s %s, %s, %s\n&quot;</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> add</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> args</span><span class="cpp1-symbol">[</span><span class="cpp1-number">0</span><span class="cpp1-symbol">],</span><span class="cpp1-space"> args</span><span class="cpp1-symbol">[</span><span class="cpp1-number">1</span><span class="cpp1-symbol">],</span><span class="cpp1-space"> zero_reg</span><span class="cpp1-symbol">);
</span><span class="cpp1-space">        num_instrct </span><span class="cpp1-symbol">+=</span><span class="cpp1-space"> </span><span class="cpp1-number">1</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">        </span><span class="cpp1-reservedword">return</span><span class="cpp1-space"> num_instrct</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">      </span><span class="cpp1-symbol">}
</span><span class="cpp1-space">      </span><span class="cpp1-reservedword">return</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">    </span><span class="cpp1-symbol">}</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">else</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">if</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">strcmp</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">name</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> </span><span class="cpp1-string">&quot;blt&quot;</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-symbol">==</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-symbol">{
</span><span class="cpp1-space">      </span><span class="cpp1-comment">/* YOUR CODE HERE */
</span><span class="cpp1-space">      </span><span class="cpp1-reservedword">if</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">num_args </span><span class="cpp1-symbol">==</span><span class="cpp1-space"> </span><span class="cpp1-number">3</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-symbol">{
</span><span class="cpp1-space">        </span><span class="cpp1-comment">/* Use $at for intermediate code */
</span><span class="cpp1-space">        </span><span class="cpp1-reservedword">char</span><span class="cpp1-symbol">*</span><span class="cpp1-space"> less_than </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-string">&quot;slt, $at&quot;</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">        </span><span class="cpp1-reservedword">char</span><span class="cpp1-symbol">*</span><span class="cpp1-space"> if_not_equal </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-string">&quot;bne, $at&quot;</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">        fprintf</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">output</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> </span><span class="cpp1-string">&quot;%s, %s, %s\n&quot;</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> less_than</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> args</span><span class="cpp1-symbol">[</span><span class="cpp1-number">0</span><span class="cpp1-symbol">],</span><span class="cpp1-space"> args</span><span class="cpp1-symbol">[</span><span class="cpp1-number">1</span><span class="cpp1-symbol">]);
</span><span class="cpp1-space">        num_instrct </span><span class="cpp1-symbol">+=</span><span class="cpp1-space"> </span><span class="cpp1-number">1</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">        fprintf</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">output</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> </span><span class="cpp1-string">&quot;%s, %s, %s\n&quot;</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> if_not_equal</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> zero_reg</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> args</span><span class="cpp1-symbol">[</span><span class="cpp1-number">2</span><span class="cpp1-symbol">]);
</span><span class="cpp1-space">        num_instrct </span><span class="cpp1-symbol">+=</span><span class="cpp1-space"> </span><span class="cpp1-number">1</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">        </span><span class="cpp1-reservedword">return</span><span class="cpp1-space"> num_instrct</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">      </span><span class="cpp1-symbol">}
</span><span class="cpp1-space">      </span><span class="cpp1-reservedword">return</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-symbol">;</span><span class="cpp1-space">  
    </span><span class="cpp1-symbol">}</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">else</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">if</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">strcmp</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">name</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> </span><span class="cpp1-string">&quot;bgt&quot;</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-symbol">==</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-symbol">{
</span><span class="cpp1-space">      </span><span class="cpp1-comment">/* YOUR CODE HERE */
</span><span class="cpp1-space">      </span><span class="cpp1-reservedword">if</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">num_args </span><span class="cpp1-symbol">==</span><span class="cpp1-space"> </span><span class="cpp1-number">3</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-symbol">{
</span><span class="cpp1-space">        </span><span class="cpp1-comment">/* Use $at for intermediate code */
</span><span class="cpp1-space">        </span><span class="cpp1-reservedword">char</span><span class="cpp1-symbol">*</span><span class="cpp1-space"> greater_than </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-string">&quot;sgt, $at&quot;</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">        </span><span class="cpp1-reservedword">char</span><span class="cpp1-symbol">*</span><span class="cpp1-space"> not_equal </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-string">&quot;bne, $at&quot;</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">        fprintf</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">output</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> </span><span class="cpp1-string">&quot;%s, %s, %s\n&quot;</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> greater_than</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> args</span><span class="cpp1-symbol">[</span><span class="cpp1-number">0</span><span class="cpp1-symbol">],</span><span class="cpp1-space"> args</span><span class="cpp1-symbol">[</span><span class="cpp1-number">1</span><span class="cpp1-symbol">]);
</span><span class="cpp1-space">        num_instrct </span><span class="cpp1-symbol">+=</span><span class="cpp1-space"> </span><span class="cpp1-number">1</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">        fprintf</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">output</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> </span><span class="cpp1-string">&quot;%s, %s, %s\n&quot;</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> not_equal</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> zero_reg</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> args</span><span class="cpp1-symbol">[</span><span class="cpp1-number">2</span><span class="cpp1-symbol">]);
</span><span class="cpp1-space">        num_instrct </span><span class="cpp1-symbol">+=</span><span class="cpp1-space"> </span><span class="cpp1-number">1</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">        </span><span class="cpp1-reservedword">return</span><span class="cpp1-space"> num_instrct</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">      </span><span class="cpp1-symbol">}
</span><span class="cpp1-space">      </span><span class="cpp1-reservedword">return</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">    </span><span class="cpp1-symbol">}</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">else</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">if</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">strcmp</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">name</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> </span><span class="cpp1-string">&quot;traddu&quot;</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-symbol">==</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-symbol">{
</span><span class="cpp1-space">      </span><span class="cpp1-comment">/* YOUR CODE HERE */
</span><span class="cpp1-space">      </span><span class="cpp1-reservedword">if</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">num_args </span><span class="cpp1-symbol">==</span><span class="cpp1-space"> </span><span class="cpp1-number">3</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-symbol">{
</span><span class="cpp1-space">        </span><span class="cpp1-reservedword">char</span><span class="cpp1-symbol">*</span><span class="cpp1-space"> add_unsigned </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-string">&quot;addu&quot;</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">        </span><span class="cpp1-reservedword">char</span><span class="cpp1-symbol">*</span><span class="cpp1-space"> a_t </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-string">&quot;$at&quot;</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">        fprintf</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">output</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> </span><span class="cpp1-string">&quot;%s %s, %s, %s\n&quot;</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> add_unsigned</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> a_t</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> args</span><span class="cpp1-symbol">[</span><span class="cpp1-number">1</span><span class="cpp1-symbol">],</span><span class="cpp1-space"> args</span><span class="cpp1-symbol">[</span><span class="cpp1-number">2</span><span class="cpp1-symbol">]);
</span><span class="cpp1-space">        num_instrct </span><span class="cpp1-symbol">+=</span><span class="cpp1-space"> </span><span class="cpp1-number">1</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">        fprintf</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">output</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> </span><span class="cpp1-string">&quot;%s %s, %s, %s\n&quot;</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> add_unsigned</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> args</span><span class="cpp1-symbol">[</span><span class="cpp1-number">3</span><span class="cpp1-symbol">],</span><span class="cpp1-space"> a_t</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> args</span><span class="cpp1-symbol">[</span><span class="cpp1-number">3</span><span class="cpp1-symbol">]);
</span><span class="cpp1-space">        num_instrct </span><span class="cpp1-symbol">+=</span><span class="cpp1-space"> </span><span class="cpp1-number">1</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">        </span><span class="cpp1-reservedword">return</span><span class="cpp1-space"> num_instrct</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">      </span><span class="cpp1-symbol">}
</span><span class="cpp1-space">      </span><span class="cpp1-reservedword">return</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-symbol">;</span><span class="cpp1-space">       
    </span><span class="cpp1-symbol">}</span><span class="cpp1-space"> 
    write_inst_string</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">output</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> name</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> args</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> num_args</span><span class="cpp1-symbol">);
</span><span class="cpp1-space">    </span><span class="cpp1-reservedword">return</span><span class="cpp1-space"> </span><span class="cpp1-number">1</span><span class="cpp1-symbol">;
}

</span><span class="cpp1-comment">/* Writes the instruction in hexadecimal format to OUTPUT during pass #2.
   
   NAME is the name of the instruction, ARGS is an array of the arguments, and
   NUM_ARGS specifies the number of items in ARGS. 

   The symbol table (SYMTBL) is given for any symbols that need to be resolved
   at this step. If a symbol should be relocated, it should be added to the
   relocation table (RELTBL), and the fields for that symbol should be set to
   all zeros. 

   You must perform error checking on all instructions and make sure that their
   arguments are valid. If an instruction is invalid, you should not write 
   anything to OUTPUT but simply return -1. MARS may be a useful resource for
   this step.

   Some function declarations for the write_*() functions are provided in translate.h, and you MUST implement these
   and use these as function headers. You may use helper functions, but you still must implement
   the provided write_* functions declared in translate.h.

   Returns 0 on success and -1 on error. 
 */
</span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> translate_inst</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">FILE</span><span class="cpp1-symbol">*</span><span class="cpp1-space"> output</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">const</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">char</span><span class="cpp1-symbol">*</span><span class="cpp1-space"> name</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">char</span><span class="cpp1-symbol">**</span><span class="cpp1-space"> args</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> size_t num_args</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> uint32_t addr</span><span class="cpp1-symbol">,
</span><span class="cpp1-space">    SymbolTable</span><span class="cpp1-symbol">*</span><span class="cpp1-space"> symtbl</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> SymbolTable</span><span class="cpp1-symbol">*</span><span class="cpp1-space"> reltbl</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-symbol">{
</span><span class="cpp1-space">    </span><span class="cpp1-reservedword">if</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">strcmp</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">name</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> </span><span class="cpp1-string">&quot;addu&quot;</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-symbol">==</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-symbol">)</span><span class="cpp1-space">       </span><span class="cpp1-reservedword">return</span><span class="cpp1-space"> write_rtype </span><span class="cpp1-symbol">(</span><span class="cpp1-hexadecimal">0x21</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> output</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> args</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> num_args</span><span class="cpp1-symbol">);
</span><span class="cpp1-space">    </span><span class="cpp1-reservedword">else</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">if</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">strcmp</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">name</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> </span><span class="cpp1-string">&quot;or&quot;</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-symbol">==</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-symbol">)</span><span class="cpp1-space">    </span><span class="cpp1-reservedword">return</span><span class="cpp1-space"> write_rtype </span><span class="cpp1-symbol">(</span><span class="cpp1-hexadecimal">0x25</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> output</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> args</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> num_args</span><span class="cpp1-symbol">);
</span><span class="cpp1-space">    </span><span class="cpp1-reservedword">else</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">if</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">strcmp</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">name</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> </span><span class="cpp1-string">&quot;slt&quot;</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-symbol">==</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-symbol">)</span><span class="cpp1-space">   </span><span class="cpp1-reservedword">return</span><span class="cpp1-space"> write_rtype </span><span class="cpp1-symbol">(</span><span class="cpp1-hexadecimal">0x2a</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> output</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> args</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> num_args</span><span class="cpp1-symbol">);
</span><span class="cpp1-space">    </span><span class="cpp1-reservedword">else</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">if</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">strcmp</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">name</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> </span><span class="cpp1-string">&quot;sltu&quot;</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-symbol">==</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-symbol">)</span><span class="cpp1-space">  </span><span class="cpp1-reservedword">return</span><span class="cpp1-space"> write_rtype </span><span class="cpp1-symbol">(</span><span class="cpp1-hexadecimal">0x2b</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> output</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> args</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> num_args</span><span class="cpp1-symbol">);
</span><span class="cpp1-space">    </span><span class="cpp1-reservedword">else</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">if</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">strcmp</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">name</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> </span><span class="cpp1-string">&quot;sll&quot;</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-symbol">==</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-symbol">)</span><span class="cpp1-space">   </span><span class="cpp1-reservedword">return</span><span class="cpp1-space"> write_shift </span><span class="cpp1-symbol">(</span><span class="cpp1-hexadecimal">0x00</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> output</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> args</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> num_args</span><span class="cpp1-symbol">);
</span><span class="cpp1-space">    </span><span class="cpp1-comment">/* YOUR CODE HERE */
</span><span class="cpp1-space">    </span><span class="cpp1-reservedword">else</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">if</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">strcmp</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">name</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> </span><span class="cpp1-string">&quot;jr&quot;</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-symbol">==</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-symbol">)</span><span class="cpp1-space">    </span><span class="cpp1-reservedword">return</span><span class="cpp1-space"> write_jr </span><span class="cpp1-symbol">(</span><span class="cpp1-hexadecimal">0x08</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> output</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> args</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> num_args</span><span class="cpp1-symbol">);
</span><span class="cpp1-space">    </span><span class="cpp1-reservedword">else</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">if</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">strcmp</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">name</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> </span><span class="cpp1-string">&quot;addiu&quot;</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-symbol">==</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-symbol">)</span><span class="cpp1-space">  </span><span class="cpp1-reservedword">return</span><span class="cpp1-space"> write_addiu </span><span class="cpp1-symbol">(</span><span class="cpp1-hexadecimal">0x09</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> output</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> args</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> num_args</span><span class="cpp1-symbol">);
</span><span class="cpp1-space">    </span><span class="cpp1-reservedword">else</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">if</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">strcmp</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">name</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> </span><span class="cpp1-string">&quot;ori&quot;</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-symbol">==</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-symbol">)</span><span class="cpp1-space">  </span><span class="cpp1-reservedword">return</span><span class="cpp1-space"> write_ori </span><span class="cpp1-symbol">(</span><span class="cpp1-hexadecimal">0x0d</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> output</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> args</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> num_args</span><span class="cpp1-symbol">);
</span><span class="cpp1-space">    </span><span class="cpp1-reservedword">else</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">if</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">strcmp</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">name</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> </span><span class="cpp1-string">&quot;lui&quot;</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-symbol">==</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-symbol">)</span><span class="cpp1-space">   </span><span class="cpp1-reservedword">return</span><span class="cpp1-space"> write_lui </span><span class="cpp1-symbol">(</span><span class="cpp1-hexadecimal">0x0f</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> output</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> args</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> num_args</span><span class="cpp1-symbol">);
</span><span class="cpp1-space">    </span><span class="cpp1-reservedword">else</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">if</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">strcmp</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">name</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> </span><span class="cpp1-string">&quot;lb&quot;</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-symbol">==</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-symbol">)</span><span class="cpp1-space">   </span><span class="cpp1-reservedword">return</span><span class="cpp1-space"> write_mem </span><span class="cpp1-symbol">(</span><span class="cpp1-hexadecimal">0x20</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> output</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> args</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> num_args</span><span class="cpp1-symbol">);
</span><span class="cpp1-space">    </span><span class="cpp1-reservedword">else</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">if</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">strcmp</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">name</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> </span><span class="cpp1-string">&quot;lbu&quot;</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-symbol">==</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-symbol">)</span><span class="cpp1-space">  </span><span class="cpp1-reservedword">return</span><span class="cpp1-space"> write_mem </span><span class="cpp1-symbol">(</span><span class="cpp1-hexadecimal">0x24</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> output</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> args</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> num_args</span><span class="cpp1-symbol">);
</span><span class="cpp1-space">    </span><span class="cpp1-reservedword">else</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">if</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">strcmp</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">name</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> </span><span class="cpp1-string">&quot;lw&quot;</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-symbol">==</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-symbol">)</span><span class="cpp1-space">   </span><span class="cpp1-reservedword">return</span><span class="cpp1-space"> write_mem </span><span class="cpp1-symbol">(</span><span class="cpp1-hexadecimal">0x23</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> output</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> args</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> num_args</span><span class="cpp1-symbol">);
</span><span class="cpp1-space">    </span><span class="cpp1-reservedword">else</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">if</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">strcmp</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">name</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> </span><span class="cpp1-string">&quot;sb&quot;</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-symbol">==</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-symbol">)</span><span class="cpp1-space">   </span><span class="cpp1-reservedword">return</span><span class="cpp1-space"> write_mem </span><span class="cpp1-symbol">(</span><span class="cpp1-hexadecimal">0x28</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> output</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> args</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> num_args</span><span class="cpp1-symbol">);
</span><span class="cpp1-space">    </span><span class="cpp1-reservedword">else</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">if</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">strcmp</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">name</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> </span><span class="cpp1-string">&quot;sw&quot;</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-symbol">==</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-symbol">)</span><span class="cpp1-space">  </span><span class="cpp1-reservedword">return</span><span class="cpp1-space"> write_mem </span><span class="cpp1-symbol">(</span><span class="cpp1-hexadecimal">0x2b</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> output</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> args</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> num_args</span><span class="cpp1-symbol">);
</span><span class="cpp1-space">    </span><span class="cpp1-reservedword">else</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">if</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">strcmp</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">name</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> </span><span class="cpp1-string">&quot;beq&quot;</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-symbol">==</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-symbol">)</span><span class="cpp1-space">   </span><span class="cpp1-reservedword">return</span><span class="cpp1-space"> write_branch </span><span class="cpp1-symbol">(</span><span class="cpp1-hexadecimal">0x04</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> output</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> args</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> num_args</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> addr</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> symtbl</span><span class="cpp1-symbol">);
</span><span class="cpp1-space">    </span><span class="cpp1-reservedword">else</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">if</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">strcmp</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">name</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> </span><span class="cpp1-string">&quot;bne&quot;</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-symbol">==</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-symbol">)</span><span class="cpp1-space">   </span><span class="cpp1-reservedword">return</span><span class="cpp1-space"> write_branch </span><span class="cpp1-symbol">(</span><span class="cpp1-hexadecimal">0x05</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> output</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> args</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> num_args</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> addr</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> symtbl</span><span class="cpp1-symbol">);
</span><span class="cpp1-space">    </span><span class="cpp1-reservedword">else</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">if</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">strcmp</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">name</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> </span><span class="cpp1-string">&quot;j&quot;</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-symbol">==</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-symbol">)</span><span class="cpp1-space">  </span><span class="cpp1-reservedword">return</span><span class="cpp1-space"> write_jump </span><span class="cpp1-symbol">(</span><span class="cpp1-hexadecimal">0x02</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> output</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> args</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> num_args</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> addr</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> reltbl</span><span class="cpp1-symbol">);
</span><span class="cpp1-space">    </span><span class="cpp1-reservedword">else</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">if</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">strcmp</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">name</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> </span><span class="cpp1-string">&quot;jal&quot;</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-symbol">==</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-symbol">)</span><span class="cpp1-space">   </span><span class="cpp1-reservedword">return</span><span class="cpp1-space"> write_jump </span><span class="cpp1-symbol">(</span><span class="cpp1-hexadecimal">0x03</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> output</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> args</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> num_args</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> addr</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> reltbl</span><span class="cpp1-symbol">);
</span><span class="cpp1-space">    </span><span class="cpp1-reservedword">else</span><span class="cpp1-space">                                 </span><span class="cpp1-reservedword">return</span><span class="cpp1-space"> </span><span class="cpp1-symbol">-</span><span class="cpp1-number">1</span><span class="cpp1-symbol">;
}

</span><span class="cpp1-comment">/* A helper function for writing most R-type instructions. You should use
   translate_reg() to parse registers and write_inst_hex() to write to 
   OUTPUT. Both are defined in translate_utils.h.

   This function is INCOMPLETE. Complete the implementation below. You will
   find bitwise operations to be the cleanest way to complete this function.
 */
</span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> write_rtype</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">uint8_t funct</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> FILE</span><span class="cpp1-symbol">*</span><span class="cpp1-space"> output</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">char</span><span class="cpp1-symbol">**</span><span class="cpp1-space"> args</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> size_t num_args</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-symbol">{
</span><span class="cpp1-space">    </span><span class="cpp1-comment">// Perhaps perform some error checking?
</span><span class="cpp1-space">    </span><span class="cpp1-reservedword">if</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">num_args </span><span class="cpp1-symbol">==</span><span class="cpp1-space"> </span><span class="cpp1-number">3</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-symbol">{
</span><span class="cpp1-space">      </span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> rd </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> translate_reg</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">args</span><span class="cpp1-symbol">[</span><span class="cpp1-number">0</span><span class="cpp1-symbol">]);
</span><span class="cpp1-space">      </span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> rs </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> translate_reg</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">args</span><span class="cpp1-symbol">[</span><span class="cpp1-number">1</span><span class="cpp1-symbol">]);
</span><span class="cpp1-space">      </span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> rt </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> translate_reg</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">args</span><span class="cpp1-symbol">[</span><span class="cpp1-number">2</span><span class="cpp1-symbol">]);
</span><span class="cpp1-space">      </span><span class="cpp1-reservedword">if</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">rd </span><span class="cpp1-symbol">&gt;=</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-space"> </span><span class="cpp1-symbol">&amp;&amp;</span><span class="cpp1-space"> rs </span><span class="cpp1-symbol">&gt;=</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-space"> </span><span class="cpp1-symbol">&amp;&amp;</span><span class="cpp1-space"> rt </span><span class="cpp1-symbol">&gt;=</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-symbol">{
</span><span class="cpp1-space">        </span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> op_code </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-octal">000000</span><span class="cpp1-space"> </span><span class="cpp1-symbol">&lt;&lt;</span><span class="cpp1-space"> </span><span class="cpp1-number">26</span><span class="cpp1-symbol">);
</span><span class="cpp1-space">        rs </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">rs </span><span class="cpp1-symbol">&lt;&lt;</span><span class="cpp1-space"> </span><span class="cpp1-number">21</span><span class="cpp1-symbol">);
</span><span class="cpp1-space">        rt </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">rt </span><span class="cpp1-symbol">&lt;&lt;</span><span class="cpp1-space"> </span><span class="cpp1-number">16</span><span class="cpp1-symbol">);
</span><span class="cpp1-space">        rd </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">rt </span><span class="cpp1-symbol">&lt;&lt;</span><span class="cpp1-space"> </span><span class="cpp1-number">11</span><span class="cpp1-symbol">);
</span><span class="cpp1-space">        </span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> shamt </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-octal">00000</span><span class="cpp1-space"> </span><span class="cpp1-symbol">&lt;&lt;</span><span class="cpp1-space"> </span><span class="cpp1-number">6</span><span class="cpp1-symbol">);
</span><span class="cpp1-space">        uint32_t instruction </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> op_code </span><span class="cpp1-symbol">|</span><span class="cpp1-space"> rs </span><span class="cpp1-symbol">|</span><span class="cpp1-space"> rt </span><span class="cpp1-symbol">|</span><span class="cpp1-space"> rd </span><span class="cpp1-symbol">|</span><span class="cpp1-space"> shamt </span><span class="cpp1-symbol">|</span><span class="cpp1-space"> funct</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">        write_inst_hex</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">output</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> instruction</span><span class="cpp1-symbol">);
</span><span class="cpp1-space">        </span><span class="cpp1-reservedword">return</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">      </span><span class="cpp1-symbol">}
</span><span class="cpp1-space">    </span><span class="cpp1-symbol">}
</span><span class="cpp1-space">    </span><span class="cpp1-reservedword">return</span><span class="cpp1-space"> </span><span class="cpp1-symbol">-</span><span class="cpp1-number">1</span><span class="cpp1-symbol">;
}

</span><span class="cpp1-comment">/* A helper function for writing shift instructions. You should use 
   translate_num() to parse numerical arguments. translate_num() is defined
   in translate_utils.h.

   This function is INCOMPLETE. Complete the implementation below. You will
   find bitwise operations to be the cleanest way to complete this function.
 */
</span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> write_shift</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">uint8_t funct</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> FILE</span><span class="cpp1-symbol">*</span><span class="cpp1-space"> output</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">char</span><span class="cpp1-symbol">**</span><span class="cpp1-space"> args</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> size_t num_args</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-symbol">{
</span><span class="cpp1-space">  </span><span class="cpp1-comment">// Perhaps perform some error checking?
</span><span class="cpp1-space">    </span><span class="cpp1-reservedword">if</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">num_args </span><span class="cpp1-symbol">==</span><span class="cpp1-space"> </span><span class="cpp1-number">3</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-symbol">{
</span><span class="cpp1-space">      </span><span class="cpp1-reservedword">long</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> shamt</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">      </span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> rd </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> translate_reg</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">args</span><span class="cpp1-symbol">[</span><span class="cpp1-number">0</span><span class="cpp1-symbol">]);
</span><span class="cpp1-space">      </span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> rt </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> translate_reg</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">args</span><span class="cpp1-symbol">[</span><span class="cpp1-number">1</span><span class="cpp1-symbol">]);
</span><span class="cpp1-space">      </span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> err </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> translate_num</span><span class="cpp1-symbol">(&amp;</span><span class="cpp1-identifier">shamt</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> args</span><span class="cpp1-symbol">[</span><span class="cpp1-number">2</span><span class="cpp1-symbol">],</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> </span><span class="cpp1-number">31</span><span class="cpp1-symbol">);
</span><span class="cpp1-space">      </span><span class="cpp1-reservedword">if</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">rt </span><span class="cpp1-symbol">&gt;=</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-space"> </span><span class="cpp1-symbol">&amp;&amp;</span><span class="cpp1-space"> rd </span><span class="cpp1-symbol">&gt;=</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-space"> </span><span class="cpp1-symbol">&amp;&amp;</span><span class="cpp1-space"> err </span><span class="cpp1-symbol">&gt;=</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-symbol">{
</span><span class="cpp1-space">        </span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> op_code </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-octal">000000</span><span class="cpp1-space"> </span><span class="cpp1-symbol">&lt;&lt;</span><span class="cpp1-space"> </span><span class="cpp1-number">26</span><span class="cpp1-symbol">);
</span><span class="cpp1-space">        </span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> rs </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-octal">00000</span><span class="cpp1-space"> </span><span class="cpp1-symbol">&lt;&lt;</span><span class="cpp1-space"> </span><span class="cpp1-number">21</span><span class="cpp1-symbol">);
</span><span class="cpp1-space">        rt </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">rt </span><span class="cpp1-symbol">&lt;&lt;</span><span class="cpp1-space"> </span><span class="cpp1-number">16</span><span class="cpp1-symbol">);
</span><span class="cpp1-space">        rd </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">rd </span><span class="cpp1-symbol">&lt;&lt;</span><span class="cpp1-space"> </span><span class="cpp1-number">11</span><span class="cpp1-symbol">);
</span><span class="cpp1-space">        shamt </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">shamt </span><span class="cpp1-symbol">&lt;&lt;</span><span class="cpp1-space"> </span><span class="cpp1-number">6</span><span class="cpp1-symbol">);
</span><span class="cpp1-space">        uint32_t instruction </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> op_code </span><span class="cpp1-symbol">|</span><span class="cpp1-space"> rs </span><span class="cpp1-symbol">|</span><span class="cpp1-space"> rt </span><span class="cpp1-symbol">|</span><span class="cpp1-space"> rd </span><span class="cpp1-symbol">|</span><span class="cpp1-space"> shamt </span><span class="cpp1-symbol">|</span><span class="cpp1-space"> funct</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">        write_inst_hex</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">output</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> instruction</span><span class="cpp1-symbol">);
</span><span class="cpp1-space">        </span><span class="cpp1-reservedword">return</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">      </span><span class="cpp1-symbol">}
</span><span class="cpp1-space">    </span><span class="cpp1-symbol">}
</span><span class="cpp1-space">    </span><span class="cpp1-reservedword">return</span><span class="cpp1-space"> </span><span class="cpp1-symbol">-</span><span class="cpp1-number">1</span><span class="cpp1-symbol">;
}

</span><span class="cpp1-comment">/* The rest of your write_*() functions below */

</span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> write_jr</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">uint8_t funct</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> FILE</span><span class="cpp1-symbol">*</span><span class="cpp1-space"> output</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">char</span><span class="cpp1-symbol">**</span><span class="cpp1-space"> args</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> size_t num_args</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-symbol">{
</span><span class="cpp1-space">    </span><span class="cpp1-comment">// Perhaps perform some error checking?
</span><span class="cpp1-space">    </span><span class="cpp1-reservedword">if</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">num_args </span><span class="cpp1-symbol">==</span><span class="cpp1-space"> </span><span class="cpp1-number">1</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-symbol">{
</span><span class="cpp1-space">      </span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> rs </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> translate_reg</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">args</span><span class="cpp1-symbol">[</span><span class="cpp1-number">0</span><span class="cpp1-symbol">]);
</span><span class="cpp1-space">      </span><span class="cpp1-reservedword">if</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">rs </span><span class="cpp1-symbol">&gt;=</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-symbol">{
</span><span class="cpp1-space">        </span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> op_code </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-octal">000000</span><span class="cpp1-space"> </span><span class="cpp1-symbol">&lt;&lt;</span><span class="cpp1-space"> </span><span class="cpp1-number">26</span><span class="cpp1-symbol">);
</span><span class="cpp1-space">        rs </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">rs </span><span class="cpp1-symbol">&lt;&lt;</span><span class="cpp1-space"> </span><span class="cpp1-number">21</span><span class="cpp1-symbol">);
</span><span class="cpp1-space">        </span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> rt </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-octal">00000</span><span class="cpp1-space"> </span><span class="cpp1-symbol">&lt;&lt;</span><span class="cpp1-space"> </span><span class="cpp1-number">16</span><span class="cpp1-symbol">);
</span><span class="cpp1-space">        </span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> rd </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-octal">00000</span><span class="cpp1-space"> </span><span class="cpp1-symbol">&lt;&lt;</span><span class="cpp1-space"> </span><span class="cpp1-number">11</span><span class="cpp1-symbol">);
</span><span class="cpp1-space">        </span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> shamt </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-octal">00000</span><span class="cpp1-space"> </span><span class="cpp1-symbol">&lt;&lt;</span><span class="cpp1-space"> </span><span class="cpp1-number">6</span><span class="cpp1-symbol">);
</span><span class="cpp1-space">        uint32_t instruction </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> op_code </span><span class="cpp1-symbol">|</span><span class="cpp1-space"> rs </span><span class="cpp1-symbol">|</span><span class="cpp1-space"> rt </span><span class="cpp1-symbol">|</span><span class="cpp1-space"> rd </span><span class="cpp1-symbol">|</span><span class="cpp1-space"> shamt </span><span class="cpp1-symbol">|</span><span class="cpp1-space"> funct</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">        write_inst_hex</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">output</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> instruction</span><span class="cpp1-symbol">);
</span><span class="cpp1-space">        </span><span class="cpp1-reservedword">return</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">      </span><span class="cpp1-symbol">}
</span><span class="cpp1-space">    </span><span class="cpp1-symbol">}
</span><span class="cpp1-space">    </span><span class="cpp1-reservedword">return</span><span class="cpp1-space"> </span><span class="cpp1-symbol">-</span><span class="cpp1-number">1</span><span class="cpp1-symbol">;
}

</span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> write_addiu</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">uint8_t opcode</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> FILE</span><span class="cpp1-symbol">*</span><span class="cpp1-space"> output</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">char</span><span class="cpp1-symbol">**</span><span class="cpp1-space"> args</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> size_t num_args</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-symbol">{
</span><span class="cpp1-space">    </span><span class="cpp1-comment">// Perhaps perform some error checking?
</span><span class="cpp1-space">    </span><span class="cpp1-reservedword">if</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">num_args </span><span class="cpp1-symbol">==</span><span class="cpp1-space"> </span><span class="cpp1-number">3</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-symbol">{
</span><span class="cpp1-space">      </span><span class="cpp1-reservedword">long</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> imm</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">      </span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> rt </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> translate_reg</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">args</span><span class="cpp1-symbol">[</span><span class="cpp1-number">0</span><span class="cpp1-symbol">]);
</span><span class="cpp1-space">      </span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> rs </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> translate_reg</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">args</span><span class="cpp1-symbol">[</span><span class="cpp1-number">1</span><span class="cpp1-symbol">]);
</span><span class="cpp1-space">      </span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> err </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> translate_num</span><span class="cpp1-symbol">(&amp;</span><span class="cpp1-identifier">imm</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> args</span><span class="cpp1-symbol">[</span><span class="cpp1-number">2</span><span class="cpp1-symbol">],</span><span class="cpp1-space"> INT16_MIN</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> INT16_MAX</span><span class="cpp1-symbol">);
</span><span class="cpp1-space">      </span><span class="cpp1-reservedword">if</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">rs </span><span class="cpp1-symbol">&gt;=</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-space"> </span><span class="cpp1-symbol">&amp;&amp;</span><span class="cpp1-space"> rt </span><span class="cpp1-symbol">&gt;=</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-space"> </span><span class="cpp1-symbol">&amp;&amp;</span><span class="cpp1-space"> err </span><span class="cpp1-symbol">&gt;=</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-symbol">{
</span><span class="cpp1-space">        </span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> op_code </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">opcode </span><span class="cpp1-symbol">&lt;&lt;</span><span class="cpp1-space"> </span><span class="cpp1-number">26</span><span class="cpp1-symbol">);
</span><span class="cpp1-space">        rs </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">rs </span><span class="cpp1-symbol">&lt;&lt;</span><span class="cpp1-space"> </span><span class="cpp1-number">21</span><span class="cpp1-symbol">);
</span><span class="cpp1-space">        rt </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">rt </span><span class="cpp1-symbol">&lt;&lt;</span><span class="cpp1-space"> </span><span class="cpp1-number">16</span><span class="cpp1-symbol">);
</span><span class="cpp1-space">        </span><span class="cpp1-reservedword">if</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">imm </span><span class="cpp1-symbol">&lt;</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-symbol">{
</span><span class="cpp1-space">          </span><span class="cpp1-comment">/* Keep only the last 16 bits and to account for unsigned */
</span><span class="cpp1-space">          imm </span><span class="cpp1-symbol">&amp;=</span><span class="cpp1-space"> </span><span class="cpp1-hexadecimal">0xFFFF</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">        </span><span class="cpp1-symbol">}
</span><span class="cpp1-space">        uint32_t instruction </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> op_code </span><span class="cpp1-symbol">|</span><span class="cpp1-space"> rs </span><span class="cpp1-symbol">|</span><span class="cpp1-space"> rt </span><span class="cpp1-symbol">|</span><span class="cpp1-space"> imm</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">        write_inst_hex</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">output</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> instruction</span><span class="cpp1-symbol">);
</span><span class="cpp1-space">        </span><span class="cpp1-reservedword">return</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">      </span><span class="cpp1-symbol">}
</span><span class="cpp1-space">    </span><span class="cpp1-symbol">}
</span><span class="cpp1-space">    </span><span class="cpp1-reservedword">return</span><span class="cpp1-space"> </span><span class="cpp1-symbol">-</span><span class="cpp1-number">1</span><span class="cpp1-symbol">;
}

</span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> write_ori</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">uint8_t opcode</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> FILE</span><span class="cpp1-symbol">*</span><span class="cpp1-space"> output</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">char</span><span class="cpp1-symbol">**</span><span class="cpp1-space"> args</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> size_t num_args</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-symbol">{
</span><span class="cpp1-space">    </span><span class="cpp1-comment">// Perhaps perform some error checking?
</span><span class="cpp1-space">    </span><span class="cpp1-reservedword">if</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">num_args </span><span class="cpp1-symbol">==</span><span class="cpp1-space"> </span><span class="cpp1-number">3</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-symbol">{
</span><span class="cpp1-space">      </span><span class="cpp1-reservedword">long</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> imm</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">      </span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> rt </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> translate_reg</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">args</span><span class="cpp1-symbol">[</span><span class="cpp1-number">0</span><span class="cpp1-symbol">]);
</span><span class="cpp1-space">      </span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> rs </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> translate_reg</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">args</span><span class="cpp1-symbol">[</span><span class="cpp1-number">1</span><span class="cpp1-symbol">]);
</span><span class="cpp1-space">      </span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> err </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> translate_num</span><span class="cpp1-symbol">(&amp;</span><span class="cpp1-identifier">imm</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> args</span><span class="cpp1-symbol">[</span><span class="cpp1-number">2</span><span class="cpp1-symbol">],</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> UINT16_MAX</span><span class="cpp1-symbol">);
</span><span class="cpp1-space">      </span><span class="cpp1-reservedword">if</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">rs </span><span class="cpp1-symbol">&gt;=</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-space"> </span><span class="cpp1-symbol">&amp;&amp;</span><span class="cpp1-space"> rt </span><span class="cpp1-symbol">&gt;=</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-space"> </span><span class="cpp1-symbol">&amp;&amp;</span><span class="cpp1-space"> err </span><span class="cpp1-symbol">&gt;=</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-symbol">{
</span><span class="cpp1-space">        </span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> op_code </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">opcode </span><span class="cpp1-symbol">&lt;&lt;</span><span class="cpp1-space"> </span><span class="cpp1-number">26</span><span class="cpp1-symbol">);
</span><span class="cpp1-space">        rs </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">rs </span><span class="cpp1-symbol">&lt;&lt;</span><span class="cpp1-space"> </span><span class="cpp1-number">21</span><span class="cpp1-symbol">);
</span><span class="cpp1-space">        rt </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">rt </span><span class="cpp1-symbol">&lt;&lt;</span><span class="cpp1-space"> </span><span class="cpp1-number">16</span><span class="cpp1-symbol">);
</span><span class="cpp1-space">        uint32_t instruction </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> op_code </span><span class="cpp1-symbol">|</span><span class="cpp1-space"> rs </span><span class="cpp1-symbol">|</span><span class="cpp1-space"> rt </span><span class="cpp1-symbol">|</span><span class="cpp1-space"> imm</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">        write_inst_hex</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">output</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> instruction</span><span class="cpp1-symbol">);
</span><span class="cpp1-space">        </span><span class="cpp1-reservedword">return</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">      </span><span class="cpp1-symbol">}
</span><span class="cpp1-space">    </span><span class="cpp1-symbol">}
</span><span class="cpp1-space">    </span><span class="cpp1-reservedword">return</span><span class="cpp1-space"> </span><span class="cpp1-symbol">-</span><span class="cpp1-number">1</span><span class="cpp1-symbol">;
}

</span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> write_lui</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">uint8_t opcode</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> FILE</span><span class="cpp1-symbol">*</span><span class="cpp1-space"> output</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">char</span><span class="cpp1-symbol">**</span><span class="cpp1-space"> args</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> size_t num_args</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-symbol">{
</span><span class="cpp1-space">    </span><span class="cpp1-comment">// Perhaps perform some error checking?
</span><span class="cpp1-space">    </span><span class="cpp1-reservedword">if</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">num_args </span><span class="cpp1-symbol">==</span><span class="cpp1-space"> </span><span class="cpp1-number">2</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-symbol">{
</span><span class="cpp1-space">      </span><span class="cpp1-reservedword">long</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> imm</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">      </span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> rt </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> translate_reg</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">args</span><span class="cpp1-symbol">[</span><span class="cpp1-number">0</span><span class="cpp1-symbol">]);
</span><span class="cpp1-space">      </span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> err </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> translate_num</span><span class="cpp1-symbol">(&amp;</span><span class="cpp1-identifier">imm</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> args</span><span class="cpp1-symbol">[</span><span class="cpp1-number">1</span><span class="cpp1-symbol">],</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> UINT16_MAX</span><span class="cpp1-symbol">);
</span><span class="cpp1-space">      </span><span class="cpp1-reservedword">if</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">rt </span><span class="cpp1-symbol">&gt;=</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-space"> </span><span class="cpp1-symbol">&amp;&amp;</span><span class="cpp1-space"> err </span><span class="cpp1-symbol">&gt;=</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-symbol">{
</span><span class="cpp1-space">        </span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> op_code </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">opcode </span><span class="cpp1-symbol">&lt;&lt;</span><span class="cpp1-space"> </span><span class="cpp1-number">26</span><span class="cpp1-symbol">);
</span><span class="cpp1-space">        </span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> rs </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-octal">00000</span><span class="cpp1-space"> </span><span class="cpp1-symbol">&lt;&lt;</span><span class="cpp1-space"> </span><span class="cpp1-number">21</span><span class="cpp1-symbol">);
</span><span class="cpp1-space">        rt </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">rt </span><span class="cpp1-symbol">&lt;&lt;</span><span class="cpp1-space"> </span><span class="cpp1-number">16</span><span class="cpp1-symbol">);
</span><span class="cpp1-space">        uint32_t instruction </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> op_code </span><span class="cpp1-symbol">|</span><span class="cpp1-space"> rs </span><span class="cpp1-symbol">|</span><span class="cpp1-space"> rt </span><span class="cpp1-symbol">|</span><span class="cpp1-space"> imm</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">        write_inst_hex</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">output</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> instruction</span><span class="cpp1-symbol">);
</span><span class="cpp1-space">        </span><span class="cpp1-reservedword">return</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">      </span><span class="cpp1-symbol">}
</span><span class="cpp1-space">    </span><span class="cpp1-symbol">}
</span><span class="cpp1-space">    </span><span class="cpp1-reservedword">return</span><span class="cpp1-space"> </span><span class="cpp1-symbol">-</span><span class="cpp1-number">1</span><span class="cpp1-symbol">;
}

</span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> write_mem</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">uint8_t opcode</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> FILE</span><span class="cpp1-symbol">*</span><span class="cpp1-space"> output</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">char</span><span class="cpp1-symbol">**</span><span class="cpp1-space"> args</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> size_t num_args</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-symbol">{
</span><span class="cpp1-space">    </span><span class="cpp1-comment">// Perhaps perform some error checking?
</span><span class="cpp1-space">    </span><span class="cpp1-reservedword">if</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">num_args </span><span class="cpp1-symbol">==</span><span class="cpp1-space"> </span><span class="cpp1-number">3</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-symbol">{
</span><span class="cpp1-space">      </span><span class="cpp1-reservedword">long</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> imm</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">      </span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> rt </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> translate_reg</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">args</span><span class="cpp1-symbol">[</span><span class="cpp1-number">0</span><span class="cpp1-symbol">]);
</span><span class="cpp1-space">      </span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> rs </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> translate_reg</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">args</span><span class="cpp1-symbol">[</span><span class="cpp1-number">2</span><span class="cpp1-symbol">]);
</span><span class="cpp1-space">      </span><span class="cpp1-comment">/* imm will be a signed number */
</span><span class="cpp1-space">      </span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> err </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> translate_num</span><span class="cpp1-symbol">(&amp;</span><span class="cpp1-identifier">imm</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> args</span><span class="cpp1-symbol">[</span><span class="cpp1-number">1</span><span class="cpp1-symbol">],</span><span class="cpp1-space"> INT16_MIN</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> INT16_MAX</span><span class="cpp1-symbol">);
</span><span class="cpp1-space">      </span><span class="cpp1-reservedword">if</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">rs </span><span class="cpp1-symbol">&gt;=</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-space"> </span><span class="cpp1-symbol">&amp;&amp;</span><span class="cpp1-space"> rt </span><span class="cpp1-symbol">&gt;=</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-space"> </span><span class="cpp1-symbol">&amp;&amp;</span><span class="cpp1-space"> err </span><span class="cpp1-symbol">&gt;=</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-symbol">{
</span><span class="cpp1-space">        </span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> op_code </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">opcode </span><span class="cpp1-symbol">&lt;&lt;</span><span class="cpp1-space"> </span><span class="cpp1-number">26</span><span class="cpp1-symbol">);
</span><span class="cpp1-space">        </span><span class="cpp1-comment">/* flipped order here */
</span><span class="cpp1-space">        rs </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">rt </span><span class="cpp1-symbol">&lt;&lt;</span><span class="cpp1-space"> </span><span class="cpp1-number">21</span><span class="cpp1-symbol">);
</span><span class="cpp1-space">        rt </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">rs </span><span class="cpp1-symbol">&lt;&lt;</span><span class="cpp1-space"> </span><span class="cpp1-number">16</span><span class="cpp1-symbol">);
</span><span class="cpp1-space">        </span><span class="cpp1-reservedword">if</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">imm </span><span class="cpp1-symbol">&lt;</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-symbol">{
</span><span class="cpp1-space">          </span><span class="cpp1-comment">/* Keep only the last 16 bits */
</span><span class="cpp1-space">          imm </span><span class="cpp1-symbol">&amp;=</span><span class="cpp1-space"> </span><span class="cpp1-hexadecimal">0xFFFF</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">        </span><span class="cpp1-symbol">}
</span><span class="cpp1-space">        uint32_t instruction </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> op_code </span><span class="cpp1-symbol">|</span><span class="cpp1-space"> rs </span><span class="cpp1-symbol">|</span><span class="cpp1-space"> rt </span><span class="cpp1-symbol">|</span><span class="cpp1-space"> imm</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">        write_inst_hex</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">output</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> instruction</span><span class="cpp1-symbol">);
</span><span class="cpp1-space">        </span><span class="cpp1-reservedword">return</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">      </span><span class="cpp1-symbol">}
</span><span class="cpp1-space">    </span><span class="cpp1-symbol">}
</span><span class="cpp1-space">    </span><span class="cpp1-reservedword">return</span><span class="cpp1-space"> </span><span class="cpp1-symbol">-</span><span class="cpp1-number">1</span><span class="cpp1-symbol">;
}

</span><span class="cpp1-comment">/*  A helper function to determine if a destination address
    can be branched to
*/
</span><span class="cpp1-reservedword">static</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> can_branch_to</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">uint32_t src_addr</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> uint32_t dest_addr</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-symbol">{
</span><span class="cpp1-space">    int32_t diff </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> dest_addr </span><span class="cpp1-symbol">-</span><span class="cpp1-space"> src_addr</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">    </span><span class="cpp1-reservedword">return</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">diff </span><span class="cpp1-symbol">&gt;=</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-space"> </span><span class="cpp1-symbol">&amp;&amp;</span><span class="cpp1-space"> diff </span><span class="cpp1-symbol">&lt;=</span><span class="cpp1-space"> TWO_POW_SEVENTEEN</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-symbol">||</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">diff </span><span class="cpp1-symbol">&lt;</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-space"> </span><span class="cpp1-symbol">&amp;&amp;</span><span class="cpp1-space"> diff </span><span class="cpp1-symbol">&gt;=</span><span class="cpp1-space"> </span><span class="cpp1-symbol">-(</span><span class="cpp1-identifier">TWO_POW_SEVENTEEN </span><span class="cpp1-symbol">-</span><span class="cpp1-space"> </span><span class="cpp1-number">4</span><span class="cpp1-symbol">));
}


</span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> write_branch</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">uint8_t opcode</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> FILE</span><span class="cpp1-symbol">*</span><span class="cpp1-space"> output</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">char</span><span class="cpp1-symbol">**</span><span class="cpp1-space"> args</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> size_t num_args</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> uint32_t addr</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> SymbolTable</span><span class="cpp1-symbol">*</span><span class="cpp1-space"> symtbl</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-symbol">{
</span><span class="cpp1-space">    </span><span class="cpp1-comment">// Perhaps perform some error checking?
</span><span class="cpp1-space">    </span><span class="cpp1-reservedword">if</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">num_args </span><span class="cpp1-symbol">==</span><span class="cpp1-space"> </span><span class="cpp1-number">3</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-symbol">{
</span><span class="cpp1-space">      </span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> rs </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> translate_reg</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">args</span><span class="cpp1-symbol">[</span><span class="cpp1-number">0</span><span class="cpp1-symbol">]);
</span><span class="cpp1-space">      </span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> rt </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> translate_reg</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">args</span><span class="cpp1-symbol">[</span><span class="cpp1-number">1</span><span class="cpp1-symbol">]);
</span><span class="cpp1-space">      </span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> label_addr </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> get_addr_for_symbol</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">symtbl</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> args</span><span class="cpp1-symbol">[</span><span class="cpp1-number">2</span><span class="cpp1-symbol">]);
</span><span class="cpp1-space">      </span><span class="cpp1-reservedword">if</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">rs </span><span class="cpp1-symbol">&gt;=</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-space"> </span><span class="cpp1-symbol">&amp;&amp;</span><span class="cpp1-space"> rt </span><span class="cpp1-symbol">&gt;=</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-space"> </span><span class="cpp1-symbol">&amp;&amp;</span><span class="cpp1-space"> label_addr </span><span class="cpp1-symbol">&gt;=</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-symbol">{
</span><span class="cpp1-space">        </span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> op_code </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">opcode </span><span class="cpp1-symbol">&lt;&lt;</span><span class="cpp1-space"> </span><span class="cpp1-number">26</span><span class="cpp1-symbol">);
</span><span class="cpp1-space">        rs </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">rt </span><span class="cpp1-symbol">&lt;&lt;</span><span class="cpp1-space"> </span><span class="cpp1-number">21</span><span class="cpp1-symbol">);
</span><span class="cpp1-space">        rt </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">rs </span><span class="cpp1-symbol">&lt;&lt;</span><span class="cpp1-space"> </span><span class="cpp1-number">16</span><span class="cpp1-symbol">);
</span><span class="cpp1-space">        </span><span class="cpp1-comment">/* PC = (PC + 4) + (imm * 4) --&gt; imm = (PC - (PC - 4)) / 4 */
</span><span class="cpp1-space">        int32_t offset </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> label_addr </span><span class="cpp1-symbol">-</span><span class="cpp1-space"> addr </span><span class="cpp1-symbol">-</span><span class="cpp1-space"> </span><span class="cpp1-number">4</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">        </span><span class="cpp1-reservedword">if</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">offset </span><span class="cpp1-symbol">%</span><span class="cpp1-space"> </span><span class="cpp1-number">4</span><span class="cpp1-space"> </span><span class="cpp1-symbol">==</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-symbol">{
</span><span class="cpp1-space">          offset </span><span class="cpp1-symbol">/=</span><span class="cpp1-space"> </span><span class="cpp1-number">4</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">          </span><span class="cpp1-comment">/* Must account for only bottom 16 bits. */
</span><span class="cpp1-space">          offset </span><span class="cpp1-symbol">&amp;=</span><span class="cpp1-space"> </span><span class="cpp1-hexadecimal">0xFFFF</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">          uint32_t instruction </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> op_code </span><span class="cpp1-symbol">|</span><span class="cpp1-space"> rs </span><span class="cpp1-symbol">|</span><span class="cpp1-space"> rt </span><span class="cpp1-symbol">|</span><span class="cpp1-space"> offset</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">          write_inst_hex</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">output</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> instruction</span><span class="cpp1-symbol">);</span><span class="cpp1-space">        
          </span><span class="cpp1-reservedword">return</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">        </span><span class="cpp1-symbol">}
</span><span class="cpp1-space">      </span><span class="cpp1-symbol">}
</span><span class="cpp1-space">    </span><span class="cpp1-symbol">}
</span><span class="cpp1-space">    </span><span class="cpp1-reservedword">return</span><span class="cpp1-space"> </span><span class="cpp1-symbol">-</span><span class="cpp1-number">1</span><span class="cpp1-symbol">;
}

</span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> write_jump</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">uint8_t opcode</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> FILE</span><span class="cpp1-symbol">*</span><span class="cpp1-space"> output</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">char</span><span class="cpp1-symbol">**</span><span class="cpp1-space"> args</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> size_t num_args</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> uint32_t addr</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> SymbolTable</span><span class="cpp1-symbol">*</span><span class="cpp1-space"> reltbl</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-symbol">{
</span><span class="cpp1-space">    </span><span class="cpp1-comment">/* YOUR CODE HERE */
</span><span class="cpp1-space">    </span><span class="cpp1-reservedword">if</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">num_args </span><span class="cpp1-symbol">==</span><span class="cpp1-space"> </span><span class="cpp1-number">1</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-symbol">{
</span><span class="cpp1-space">      </span><span class="cpp1-reservedword">char</span><span class="cpp1-symbol">*</span><span class="cpp1-space"> place_to_go_to </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> args</span><span class="cpp1-symbol">[</span><span class="cpp1-number">0</span><span class="cpp1-symbol">];
</span><span class="cpp1-space">      add_to_table</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">reltbl</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> place_to_go_to</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> addr</span><span class="cpp1-symbol">);
</span><span class="cpp1-space">      </span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> op_code </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">opcode </span><span class="cpp1-symbol">&lt;&lt;</span><span class="cpp1-space"> </span><span class="cpp1-number">26</span><span class="cpp1-symbol">);
</span><span class="cpp1-space">      </span><span class="cpp1-comment">/* Needs to be relocated, so all bits should be 0 for imm */
</span><span class="cpp1-space">      uint32_t instruction </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> op_code</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">      write_inst_hex</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">output</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> instruction</span><span class="cpp1-symbol">);
</span><span class="cpp1-space">      </span><span class="cpp1-reservedword">return</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">    </span><span class="cpp1-symbol">}
</span><span class="cpp1-space">    </span><span class="cpp1-reservedword">return</span><span class="cpp1-space"> </span><span class="cpp1-symbol">-</span><span class="cpp1-number">1</span><span class="cpp1-symbol">;
}
</span></span>
</code></pre>
</body>
</html>